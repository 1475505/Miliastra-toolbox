import{j as e}from"./markdown-vendor.js";import{r as a}from"./react-vendor.js";function M(){const[t,x]=a.useState([]),[g,m]=a.useState(0),[h,j]=a.useState(!1),[c,w]=a.useState(""),[p,f]=a.useState("likes"),[o,d]=a.useState(1),[C,r]=a.useState(!1),[b,k]=a.useState(null),[_,v]=a.useState(null),N=50;a.useEffect(()=>{y()},[c,p,o]);const y=async()=>{j(!0);try{const l=(o-1)*N,i=new URLSearchParams({sort_by:p,limit:N.toString(),offset:l.toString()});c&&i.append("search",c);const s=await(await fetch(`/api/v1/notes?${i}`)).json();s.success&&(x(s.data.items),m(s.data.total))}catch(l){console.error("åŠ è½½ç¬”è®°å¤±è´¥:",l)}finally{j(!1)}},S=async l=>{const i=JSON.parse(localStorage.getItem("likedNotes")||"[]");if(i.includes(l)){alert("æ‚¨å·²ç»ä¸ºè¯¥ç¬”è®°ç‚¹è¿‡èµäº†");return}try{const s=await(await fetch(`/api/v1/notes/${l}/like`,{method:"POST"})).json();s.success?(i.push(l),localStorage.setItem("likedNotes",JSON.stringify(i)),y()):alert(s.error||"ç‚¹èµå¤±è´¥")}catch(n){console.error("ç‚¹èµå¤±è´¥:",n),alert("ç‚¹èµå¤±è´¥")}},U=l=>JSON.parse(localStorage.getItem("likedNotes")||"[]").includes(l),u=Math.ceil(g/N);return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 p-6 pl-16 lg:pl-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-slate-900",children:"ç¬”è®°"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("input",{type:"text",placeholder:"æœç´¢ç¬”è®°å†…å®¹æˆ–ä½œè€…...",value:c,onChange:l=>{w(l.target.value),d(1)},className:"px-4 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("select",{value:p,onChange:l=>{f(l.target.value),d(1)},className:"px-4 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:"likes",children:"æŒ‰ç‚¹èµæ•°æ’åº"}),e.jsx("option",{value:"created_at",children:"æŒ‰åˆ›å»ºæ—¶é—´æ’åº"})]}),e.jsx("button",{onClick:()=>r(!0),className:"px-4 py-2 rounded-xl bg-blue-500 text-white font-medium hover:bg-blue-600 transition-colors text-sm whitespace-nowrap",children:"âœï¸ æ–°å¢ç¬”è®°"})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-slate-600",children:["å…± ",g," æ¡ç¬”è®°",c&&` Â· æœç´¢: "${c}"`]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-500",children:"åŠ è½½ä¸­..."})}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ“"}),e.jsx("div",{children:"æš‚æ— ç¬”è®°"}),c&&e.jsx("div",{className:"text-sm mt-2",children:"è¯•è¯•å…¶ä»–æœç´¢è¯"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:t.map(l=>e.jsx(E,{note:l,isExpanded:b===l.id,isEditing:_===l.id,hasLiked:U(l.id),onToggleExpand:()=>k(b===l.id?null:l.id),onLike:()=>S(l.id),onEdit:()=>v(l.id),onEditComplete:()=>{v(null),y()},onEditCancel:()=>v(null)},l.id))}),u>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>d(Math.max(1,o-1)),disabled:o===1,className:"px-3 py-1.5 rounded-lg bg-white/50 text-sm font-medium text-slate-700 hover:bg-white/70 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ä¸Šä¸€é¡µ"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,u)},(l,i)=>{let n;return u<=5||o<=3?n=i+1:o>=u-2?n=u-4+i:n=o-2+i,e.jsx("button",{onClick:()=>d(n),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${o===n?"bg-blue-500 text-white":"bg-white/50 text-slate-700 hover:bg-white/70"}`,children:n},n)})}),e.jsx("button",{onClick:()=>d(Math.min(u,o+1)),disabled:o===u,className:"px-3 py-1.5 rounded-lg bg-white/50 text-sm font-medium text-slate-700 hover:bg-white/70 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ä¸‹ä¸€é¡µ"})]})]})}),C&&e.jsx(P,{onClose:()=>r(!1),onSuccess:()=>{r(!1),d(1),y()}})]})}function E({note:t,isExpanded:x,isEditing:g,hasLiked:m,onToggleExpand:h,onLike:j,onEdit:c,onEditComplete:w,onEditCancel:p}){const[f,o]=a.useState(t.content),[d,C]=a.useState(t.author||""),[r,b]=a.useState(t.img_url||""),[k,_]=a.useState(t.video_url||""),[v,N]=a.useState(!1),[y,S]=a.useState(!1),[U,u]=a.useState(!1),l=async()=>{if(!f.trim()){alert("ç¬”è®°å†…å®¹ä¸èƒ½ä¸ºç©º");return}N(!0);try{const I=await(await fetch(`/api/v1/notes/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:f,author:d||void 0,img_url:r||void 0,video_url:k||void 0})})).json();I.success?w():alert(I.error||"ä¿®æ”¹å¤±è´¥")}catch(s){console.error("ä¿®æ”¹å¤±è´¥:",s),alert("ä¿®æ”¹å¤±è´¥")}finally{N(!1)}},i=s=>new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),n=s=>s?s.startsWith("http://")||s.startsWith("https://")?s:`https://${s}`:"";return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200 shadow-lg hover:shadow-xl transition-all p-4 flex flex-col",children:[g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("input",{type:"text",value:d,onChange:s=>C(s.target.value),placeholder:"ä½œè€…ï¼ˆå¯é€‰ï¼‰",className:"w-full px-3 py-2 rounded-lg border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsx("textarea",{value:f,onChange:s=>o(s.target.value),placeholder:"ç¬”è®°å†…å®¹",rows:6,className:"w-full px-3 py-2 rounded-lg border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm resize-none"}),e.jsx("input",{type:"text",value:r,onChange:s=>b(s.target.value),placeholder:"å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰",className:"w-full px-3 py-2 rounded-lg border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsx("input",{type:"text",value:k,onChange:s=>_(s.target.value),placeholder:"è§†é¢‘é“¾æ¥ï¼ˆå¯é€‰ï¼‰",className:"w-full px-3 py-2 rounded-lg border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:l,disabled:v,className:"flex-1 px-4 py-2 rounded-lg bg-blue-500 text-white font-medium hover:bg-blue-600 disabled:opacity-50 transition-colors text-sm",children:v?"ä¿å­˜ä¸­...":"ä¿å­˜"}),e.jsx("button",{onClick:p,disabled:v,className:"flex-1 px-4 py-2 rounded-lg bg-slate-300 text-slate-700 font-medium hover:bg-slate-400 disabled:opacity-50 transition-colors text-sm",children:"å–æ¶ˆ"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-slate-800 text-sm leading-relaxed whitespace-pre-wrap cursor-pointer ${x?"":"line-clamp-4"}`,onClick:h,children:t.content}),!x&&(t.img_url||t.video_url)&&e.jsxs("div",{className:"mt-2 flex gap-2",children:[t.img_url&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"ğŸ–¼ï¸ æœ‰å›¾ç‰‡"}),t.video_url&&e.jsx("a",{href:n(t.video_url),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 hover:bg-purple-200 transition-colors cursor-pointer",onClick:s=>s.stopPropagation(),children:"ğŸ¥ è§‚çœ‹è§†é¢‘"})]}),x&&e.jsxs("div",{className:"mt-3 space-y-3",children:[t.img_url&&e.jsx("div",{children:y?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.img_url,alt:"ç¬”è®°å›¾ç‰‡",className:"w-full rounded-lg cursor-zoom-in hover:opacity-95 transition-opacity",onClick:()=>u(!0)}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:()=>S(!1),className:"bg-black/50 text-white p-1 rounded-full hover:bg-black/70",title:"éšè—å›¾ç‰‡",children:"âœ•"})})]}):e.jsxs("button",{onClick:()=>S(!0),className:"w-full py-8 border-2 border-dashed border-slate-300 rounded-lg text-slate-500 hover:border-blue-400 hover:text-blue-500 transition-colors flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ–¼ï¸"}),e.jsx("span",{className:"text-sm",children:"ç‚¹å‡»åŠ è½½å›¾ç‰‡"})]})}),t.video_url&&e.jsxs("a",{href:n(t.video_url),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 rounded-lg bg-purple-50 text-purple-700 hover:bg-purple-100 transition-colors",onClick:s=>s.stopPropagation(),children:[e.jsx("span",{className:"text-xl",children:"ğŸ¥"}),e.jsx("span",{className:"text-sm font-medium truncate flex-1",children:t.video_url}),e.jsx("span",{className:"text-xs opacity-70",children:"ç‚¹å‡»è§‚çœ‹"})]})]}),t.content.length>100&&e.jsx("button",{onClick:h,className:"mt-2 text-xs text-blue-600 hover:text-blue-700 font-medium",children:x?"æ”¶èµ·":"å±•å¼€å…¨æ–‡"})]}),x&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-200 text-xs text-slate-500 space-y-1",children:[t.author&&e.jsxs("div",{children:["ğŸ‘¤ ä½œè€…: ",t.author]}),e.jsxs("div",{children:["ğŸ“… åˆ›å»º: ",i(t.created_at)]}),t.version!==t.created_at&&e.jsxs("div",{children:["ğŸ”„ æ›´æ–°: ",i(t.version)]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-slate-200",children:[e.jsxs("button",{onClick:j,disabled:m,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${m?"bg-red-100 text-red-600 cursor-not-allowed":"bg-white/80 text-slate-700 hover:bg-red-50 hover:text-red-600"}`,title:m?"å·²ç‚¹èµ":"ç‚¹èµ",children:[e.jsx("span",{className:"text-base",children:m?"â¤ï¸":"ğŸ¤"}),e.jsx("span",{children:t.likes})]}),e.jsxs("button",{onClick:c,className:"flex items-center gap-1 px-3 py-1.5 rounded-lg bg-white/80 text-slate-700 hover:bg-blue-50 hover:text-blue-600 text-sm font-medium transition-colors",children:[e.jsx("span",{children:"âœï¸"}),e.jsx("span",{children:"ä¿®æ­£"})]}),!x&&t.author&&e.jsxs("div",{className:"ml-auto text-xs text-slate-500",children:["ğŸ‘¤ ",t.author]})]})]}),U&&t.img_url&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4 cursor-zoom-out",onClick:()=>u(!1),children:[e.jsx("img",{src:t.img_url,alt:"ç¬”è®°å›¾ç‰‡å¤§å›¾",className:"max-w-full max-h-full object-contain rounded-lg"}),e.jsx("button",{className:"absolute top-4 right-4 text-white/70 hover:text-white text-4xl",onClick:()=>u(!1),children:"Ã—"})]})]})}function P({onClose:t,onSuccess:x}){const[g,m]=a.useState(""),[h,j]=a.useState(""),[c,w]=a.useState(""),[p,f]=a.useState(""),[o,d]=a.useState(!1),C=async()=>{if(!h.trim()){alert("ç¬”è®°å†…å®¹ä¸èƒ½ä¸ºç©º");return}d(!0);try{const b=await(await fetch("/api/v1/notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author:g||void 0,content:h,img_url:c||void 0,video_url:p||void 0})})).json();b.success?x():alert(b.error||"åˆ›å»ºå¤±è´¥")}catch(r){console.error("åˆ›å»ºå¤±è´¥:",r),alert("åˆ›å»ºå¤±è´¥")}finally{d(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-4",children:"æ–°å¢ç¬”è®°"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"ä½œè€…ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",value:g,onChange:r=>m(r.target.value),placeholder:"è¾“å…¥ä½œè€…åç§°",className:"w-full px-4 py-2 rounded-xl border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["ç¬”è®°å†…å®¹ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:h,onChange:r=>j(r.target.value),placeholder:"è¾“å…¥ç¬”è®°å†…å®¹...",rows:8,className:"w-full px-4 py-2 rounded-xl border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",value:c,onChange:r=>w(r.target.value),placeholder:"è¾“å…¥å›¾ç‰‡ URL",className:"w-full px-4 py-2 rounded-xl border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"è§†é¢‘é“¾æ¥ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",value:p,onChange:r=>f(r.target.value),placeholder:"è¾“å…¥è§†é¢‘ URL",className:"w-full px-4 py-2 rounded-xl border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:C,disabled:o,className:"flex-1 px-6 py-3 rounded-xl bg-blue-500 text-white font-medium hover:bg-blue-600 disabled:opacity-50 transition-colors",children:o?"åˆ›å»ºä¸­...":"åˆ›å»º"}),e.jsx("button",{onClick:t,disabled:o,className:"flex-1 px-6 py-3 rounded-xl bg-slate-300 text-slate-700 font-medium hover:bg-slate-400 disabled:opacity-50 transition-colors",children:"å–æ¶ˆ"})]})]})})}export{M as default};
