import{j as e}from"./markdown-vendor-CxDQP4uD.js";import{r}from"./react-vendor-KfUPlHYY.js";function D(){const[s,d]=r.useState([]),[p,h]=r.useState(0),[u,j]=r.useState(!1),[i,g]=r.useState(""),[c,f]=r.useState(""),[x,b]=r.useState("likes"),[n,a]=r.useState(1),[y,N]=r.useState(!1),[I,C]=r.useState(null),[U,S]=r.useState(null),w=50;r.useEffect(()=>{k()},[i,x,n]),r.useEffect(()=>{const t=setTimeout(()=>{g(l=>l!==c?(a(1),c):l)},1e3);return()=>clearTimeout(t)},[c]);const k=async()=>{j(!0);try{const t=(n-1)*w,l=new URLSearchParams({sort_by:x,limit:w.toString(),offset:t.toString()});i&&l.append("search",i);const v=await(await fetch(`/api/v1/notes?${l}`)).json();v.success&&(d(v.data.items),h(v.data.total))}catch(t){console.error("åŠ è½½ç¬”è®°å¤±è´¥:",t)}finally{j(!1)}},P=async t=>{const l=JSON.parse(localStorage.getItem("likedNotes")||"[]");if(l.includes(t)){alert("æ‚¨å·²ç»ä¸ºè¯¥ç¬”è®°ç‚¹è¿‡èµäº†");return}try{const v=await(await fetch(`/api/v1/notes/${t}/like`,{method:"POST"})).json();v.success?(l.push(t),localStorage.setItem("likedNotes",JSON.stringify(l)),k()):alert(v.error||"ç‚¹èµå¤±è´¥")}catch(o){console.error("ç‚¹èµå¤±è´¥:",o),alert("ç‚¹èµå¤±è´¥")}},_=t=>JSON.parse(localStorage.getItem("likedNotes")||"[]").includes(t),m=Math.ceil(p/w);return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 p-6 pl-16 lg:pl-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-slate-900",children:"ç¬”è®°"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx("input",{type:"text",placeholder:"æœç´¢ç¬”è®°å†…å®¹æˆ–ä½œè€…...",value:c,onChange:t=>{f(t.target.value)},onKeyDown:t=>{t.key==="Enter"&&(g(c),a(1))},onBlur:()=>{g(c),a(1)},className:"px-4 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("select",{value:x,onChange:t=>{b(t.target.value),a(1)},className:"px-4 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:"likes",children:"æŒ‰ç‚¹èµæ•°æ’åº"}),e.jsx("option",{value:"created_at",children:"æŒ‰åˆ›å»ºæ—¶é—´æ’åº"})]}),e.jsx("button",{onClick:()=>N(!0),className:"px-4 py-2 rounded-xl bg-blue-500 text-white font-medium hover:bg-blue-600 transition-colors text-sm whitespace-nowrap",children:"âœï¸ æ–°å¢ç¬”è®°"})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-slate-600",children:["å…± ",p," æ¡ç¬”è®°",i&&` Â· æœç´¢: "${i}"`]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-500",children:"åŠ è½½ä¸­..."})}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ“"}),e.jsx("div",{children:"æš‚æ— ç¬”è®°"}),i&&e.jsx("div",{className:"text-sm mt-2",children:"è¯•è¯•å…¶ä»–æœç´¢è¯"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:s.map(t=>e.jsx(M,{note:t,isExpanded:I===t.id,isEditing:U===t.id,hasLiked:_(t.id),onToggleExpand:()=>C(I===t.id?null:t.id),onLike:()=>P(t.id),onEdit:()=>S(t.id),onEditComplete:()=>{S(null),k()},onEditCancel:()=>S(null)},t.id))}),m>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>a(Math.max(1,n-1)),disabled:n===1,className:"px-3 py-1.5 rounded-lg bg-white/50 text-sm font-medium text-slate-700 hover:bg-white/70 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ä¸Šä¸€é¡µ"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,m)},(t,l)=>{let o;return m<=5||n<=3?o=l+1:n>=m-2?o=m-4+l:o=n-2+l,e.jsx("button",{onClick:()=>a(o),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${n===o?"bg-blue-500 text-white":"bg-white/50 text-slate-700 hover:bg-white/70"}`,children:o},o)})}),e.jsx("button",{onClick:()=>a(Math.min(m,n+1)),disabled:n===m,className:"px-3 py-1.5 rounded-lg bg-white/50 text-sm font-medium text-slate-700 hover:bg-white/70 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"ä¸‹ä¸€é¡µ"})]})]})}),y&&e.jsx(O,{onClose:()=>N(!1),onSuccess:()=>{N(!1),a(1),k()}})]})}function M({note:s,isExpanded:d,isEditing:p,hasLiked:h,onToggleExpand:u,onLike:j,onEdit:i,onEditComplete:g,onEditCancel:c}){const[f,x]=r.useState(s.content),[b,n]=r.useState(s.author||""),[a,y]=r.useState(s.img_url||""),[N,I]=r.useState(s.video_url||""),[C,U]=r.useState(!1),[S,w]=r.useState(!1),k=async()=>{if(!f.trim()){alert("ç¬”è®°å†…å®¹ä¸èƒ½ä¸ºç©º");return}U(!0);try{const l=await(await fetch(`/api/v1/notes/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:f,author:b||void 0,img_url:a||void 0,video_url:N||void 0})})).json();l.success?g():alert(l.error||"ä¿®æ”¹å¤±è´¥")}catch(t){console.error("ä¿®æ”¹å¤±è´¥:",t),alert("ä¿®æ”¹å¤±è´¥")}finally{U(!1)}},P=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),_=t=>t?t.startsWith("http://")||t.startsWith("https://")?t:`https://${t}`:"",m=t=>{if(!t)return;const l=_(t),o=window.open("","_blank");if(!o){window.open(l,"_blank","noopener,noreferrer");return}const E=`<!doctype html>
      <html lang="zh-CN">
        <head>
          <meta charset="utf-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1" />
          <title>å›¾ç‰‡é¢„è§ˆ</title>
          <style>
            html,body{height:100%;margin:0;background:#111;color:#fff;display:flex;align-items:center;justify-content:center}
            img{max-width:100%;max-height:100%;object-fit:contain;box-shadow:0 0 20px rgba(0,0,0,0.5)}
            .wrap{width:100%;height:100%;display:flex;align-items:center;justify-content:center}
          </style>
        </head>
        <body>
          <div class="wrap">
          <img src="${l.replace(/"/g,"&quot;")}" alt="å›¾ç‰‡é¢„è§ˆ"/>
          </div>
        </body>
      </html>`;try{o.document.open(),o.document.write(E),o.document.close()}catch($){console.error("Failed to write to new window",$),o.location.href=l}};return e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200 shadow-lg hover:shadow-xl transition-all p-4 flex flex-col",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("input",{type:"text",value:b,onChange:t=>n(t.target.value),placeholder:"ä½œè€…ï¼ˆå¯é€‰ï¼‰",className:"w-full px-3 py-2 rounded-lg border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsx("textarea",{value:f,onChange:t=>x(t.target.value),placeholder:"ç¬”è®°å†…å®¹",rows:6,className:"w-full px-3 py-2 rounded-lg border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm resize-none"}),e.jsx("input",{type:"text",value:a,onChange:t=>y(t.target.value),placeholder:"å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰",className:"w-full px-3 py-2 rounded-lg border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsx("input",{type:"text",value:N,onChange:t=>I(t.target.value),placeholder:"è§†é¢‘é“¾æ¥ï¼ˆå¯é€‰ï¼‰",className:"w-full px-3 py-2 rounded-lg border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:k,disabled:C,className:"flex-1 px-4 py-2 rounded-lg bg-blue-500 text-white font-medium hover:bg-blue-600 disabled:opacity-50 transition-colors text-sm",children:C?"ä¿å­˜ä¸­...":"ä¿å­˜"}),e.jsx("button",{onClick:c,disabled:C,className:"flex-1 px-4 py-2 rounded-lg bg-slate-300 text-slate-700 font-medium hover:bg-slate-400 disabled:opacity-50 transition-colors text-sm",children:"å–æ¶ˆ"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-slate-800 text-sm leading-relaxed whitespace-pre-wrap cursor-pointer ${d?"":"line-clamp-4"}`,onClick:u,children:s.content}),!d&&(s.img_url||s.video_url)&&e.jsxs("div",{className:"mt-2 flex gap-2",children:[s.img_url&&e.jsx("span",{role:"button",tabIndex:0,onClick:t=>{t.stopPropagation(),u()},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),u())},className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 cursor-pointer hover:bg-blue-200 transition-colors",children:"ğŸ–¼ï¸ æœ‰å›¾ç‰‡"}),s.video_url&&e.jsx("a",{href:_(s.video_url),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 hover:bg-purple-200 transition-colors cursor-pointer",onClick:t=>t.stopPropagation(),children:"ğŸ¥ è§‚çœ‹è§†é¢‘"})]}),d&&e.jsxs("div",{className:"mt-3 space-y-3",children:[s.img_url&&e.jsx("div",{children:S?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.img_url,alt:"ç¬”è®°å›¾ç‰‡",className:"w-full rounded-lg cursor-pointer hover:opacity-95 transition-opacity",onClick:t=>{t.stopPropagation(),m(s.img_url||"")}}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:()=>w(!1),className:"bg-black/50 text-white p-1 rounded-full hover:bg-black/70",title:"éšè—å›¾ç‰‡",children:"âœ•"})})]}):e.jsxs("button",{onClick:()=>w(!0),className:"w-full py-8 border-2 border-dashed border-slate-300 rounded-lg text-slate-500 hover:border-blue-400 hover:text-blue-500 transition-colors flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ–¼ï¸"}),e.jsx("span",{className:"text-sm",children:"ç‚¹å‡»åŠ è½½å›¾ç‰‡"})]})}),s.video_url&&e.jsxs("a",{href:_(s.video_url),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 rounded-lg bg-purple-50 text-purple-700 hover:bg-purple-100 transition-colors",onClick:t=>t.stopPropagation(),children:[e.jsx("span",{className:"text-xl",children:"ğŸ¥"}),e.jsx("span",{className:"text-sm font-medium truncate flex-1",children:s.video_url}),e.jsx("span",{className:"text-xs opacity-70",children:"ç‚¹å‡»è§‚çœ‹"})]})]}),s.content.length>100&&e.jsx("button",{onClick:u,className:"mt-2 text-xs text-blue-600 hover:text-blue-700 font-medium",children:d?"æ”¶èµ·":"å±•å¼€å…¨æ–‡"})]}),d&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-200 text-xs text-slate-500 space-y-1",children:[s.author&&e.jsxs("div",{children:["ğŸ‘¤ ä½œè€…: ",s.author]}),e.jsxs("div",{children:["ğŸ“… åˆ›å»º: ",P(s.created_at)]}),s.version!==s.created_at&&e.jsxs("div",{children:["ğŸ”„ æ›´æ–°: ",P(s.version)]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-slate-200",children:[e.jsxs("button",{onClick:j,disabled:h,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${h?"bg-red-100 text-red-600 cursor-not-allowed":"bg-white/80 text-slate-700 hover:bg-red-50 hover:text-red-600"}`,title:h?"å·²ç‚¹èµ":"ç‚¹èµ",children:[e.jsx("span",{className:"text-base",children:h?"â¤ï¸":"ğŸ¤"}),e.jsx("span",{children:s.likes})]}),e.jsxs("button",{onClick:i,className:"flex items-center gap-1 px-3 py-1.5 rounded-lg bg-white/80 text-slate-700 hover:bg-blue-50 hover:text-blue-600 text-sm font-medium transition-colors",children:[e.jsx("span",{children:"âœï¸"}),e.jsx("span",{children:"ä¿®æ­£"})]}),!d&&s.author&&e.jsxs("div",{className:"ml-auto text-xs text-slate-500",children:["ğŸ‘¤ ",s.author]})]})]})})}function O({onClose:s,onSuccess:d}){const[p,h]=r.useState(""),[u,j]=r.useState(""),[i,g]=r.useState(""),[c,f]=r.useState(""),[x,b]=r.useState(!1),n=async()=>{if(!u.trim()){alert("ç¬”è®°å†…å®¹ä¸èƒ½ä¸ºç©º");return}b(!0);try{const y=await(await fetch("/api/v1/notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({author:p||void 0,content:u,img_url:i||void 0,video_url:c||void 0})})).json();y.success?d():alert(y.error||"åˆ›å»ºå¤±è´¥")}catch(a){console.error("åˆ›å»ºå¤±è´¥:",a),alert("åˆ›å»ºå¤±è´¥")}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-4",children:"æ–°å¢ç¬”è®°"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"ä½œè€…ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",value:p,onChange:a=>h(a.target.value),placeholder:"è¾“å…¥ä½œè€…åç§°",className:"w-full px-4 py-2 rounded-xl border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["ç¬”è®°å†…å®¹ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:u,onChange:a=>j(a.target.value),placeholder:"è¾“å…¥ç¬”è®°å†…å®¹...",rows:8,className:"w-full px-4 py-2 rounded-xl border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",value:i,onChange:a=>g(a.target.value),placeholder:"å¯é€šè¿‡å›¾åºŠåŠŸèƒ½ä¸Šä¼ å›¾ç‰‡",className:"w-full px-4 py-2 rounded-xl border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"è§†é¢‘é“¾æ¥ï¼ˆå¯é€‰ï¼‰"}),e.jsx("input",{type:"text",value:c,onChange:a=>f(a.target.value),placeholder:"è¾“å…¥åƒæ˜Ÿå¥‡åŸŸç›¸å…³çš„Bç«™è§†é¢‘é“¾æ¥",className:"w-full px-4 py-2 rounded-xl border border-slate-300 bg-white/80 focus:outline-none focus:ring-2 focus:ring-blue-400"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:n,disabled:x,className:"flex-1 px-6 py-3 rounded-xl bg-blue-500 text-white font-medium hover:bg-blue-600 disabled:opacity-50 transition-colors",children:x?"åˆ›å»ºä¸­...":"åˆ›å»º"}),e.jsx("button",{onClick:s,disabled:x,className:"flex-1 px-6 py-3 rounded-xl bg-slate-300 text-slate-700 font-medium hover:bg-slate-400 disabled:opacity-50 transition-colors",children:"å–æ¶ˆ"})]})]})})}export{D as default};
