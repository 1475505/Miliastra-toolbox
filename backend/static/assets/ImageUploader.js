import{j as e}from"./markdown-vendor.js";import{r}from"./react-vendor.js";const D="cos_config",O=()=>{const s=localStorage.getItem(D);if(s)try{return JSON.parse(s)}catch{return{useDefault:!0}}return{useDefault:!0}},$=s=>{localStorage.setItem(D,JSON.stringify(s))};function E(s){const n=(f,p=2)=>f.toString().padStart(p,"0"),a=s.getFullYear(),o=n(s.getMonth()+1),i=n(s.getDate()),c=n(s.getHours()),d=n(s.getMinutes()),m=n(s.getSeconds());return`${a}${o}${i}_${c}${d}${m}`}function F(s,n){s||(s="file");let a=s,o="";const i=s.lastIndexOf(".");if(i!==-1)a=s.slice(0,i),o=s.slice(i+1);else if(n){const d=n.split("/");d.length>1&&(o=d[1])}a=a.trim().replace(/[\\/\\s]+/g,"_");const c=E(new Date);return`${a}_${c}${o?`.${o}`:""}`}function P(){const[s,n]=r.useState(O()),[a,o]=r.useState(null),[i,c]=r.useState(null),[d,m]=r.useState(""),[f,p]=r.useState(!1),[x,h]=r.useState(null),[N,g]=r.useState(null),[S,j]=r.useState(!1);r.useEffect(()=>{const t=l=>{if(l.clipboardData&&l.clipboardData.items)for(let u=0;u<l.clipboardData.items.length;u++){const b=l.clipboardData.items[u];if(b.type.indexOf("image")!==-1){const v=b.getAsFile();v&&w(v)}}};return window.addEventListener("paste",t),()=>window.removeEventListener("paste",t)},[]);const w=t=>{o(t),m(F(t.name,t.type)),h(null),g(null);const l=new FileReader;l.onloadend=()=>{c(l.result)},l.readAsDataURL(t)},y=r.useCallback(t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?j(!0):t.type==="dragleave"&&j(!1)},[]),C=r.useCallback(t=>{t.preventDefault(),t.stopPropagation(),j(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&w(t.dataTransfer.files[0])},[]),k=async()=>{if(!s.useDefault){g("è¯·å‹¾é€‰é»˜è®¤é…ç½®ï¼Œæˆ–é…ç½®è‡ªå·±çš„è…¾è®¯äº‘COSæœåŠ¡æ¥ç»§ç»­(åŽç»­æ”¯æŒè‡ªå®šä¹‰)");return}if(!a){g("è¯·é€‰æ‹©æ–‡ä»¶");return}p(!0),g(null);try{const t=new FormData,l=new File([a],d,{type:a.type});t.append("file",l);const u=await fetch("/api/v1/upload",{method:"POST",body:t});if(!u.ok){const v=await u.json().catch(()=>({}));throw new Error(v.detail||"ä¸Šä¼ å¤±è´¥")}const b=await u.json();h(b)}catch(t){console.error(t),g(t.message||"ä¸Šä¼ å¤±è´¥")}finally{p(!1)}};return e.jsxs("div",{className:"h-full flex flex-col p-6 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"å›¾åºŠä¸Šä¼ "}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer text-sm text-slate-600 bg-white/50 px-3 py-2 rounded-lg hover:bg-white/80 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:s.useDefault,onChange:t=>{const l={useDefault:t.target.checked};n(l),$(l)},className:"rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆè¯·æŒ‰éœ€ä½¿ç”¨ï¼‰"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6",children:[e.jsx("div",{className:`flex-1 border-2 border-dashed rounded-3xl flex flex-col items-center justify-center p-8 transition-all ${S?"border-blue-500 bg-blue-50/50":"border-slate-300 hover:border-blue-400 bg-white/30"}`,onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:C,children:i?e.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center",children:[e.jsx("img",{src:i,alt:"Preview",className:"max-h-[60vh] object-contain rounded-lg shadow-lg mb-4"}),e.jsx("button",{onClick:()=>{o(null),c(null),h(null)},className:"absolute top-0 right-0 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 shadow-md transform translate-x-1/2 -translate-y-1/2",children:"âœ•"})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¤"}),e.jsx("p",{className:"text-xl text-slate-600 mb-2",children:"ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ"}),e.jsx("p",{className:"text-sm text-slate-400",children:"æ”¯æŒ Ctrl+V ç²˜è´´"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>t.target.files&&t.target.files[0]&&w(t.target.files[0]),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})}),a&&!x&&e.jsxs("div",{className:"bg-white/60 p-6 rounded-2xl backdrop-blur-sm border border-white/40 shadow-sm",children:[e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"æ–‡ä»¶å"}),e.jsx("input",{type:"text",value:d,onChange:t=>m(t.target.value),className:"w-full px-3 py-2 bg-white/50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("p",{className:"mt-1 text-xs text-slate-400",children:["é»˜è®¤ç”Ÿæˆæ ¼å¼: [æºæ–‡ä»¶å]_",e.jsx("span",{className:"font-mono",children:"yyyyMMdd_hhmmss"}),".[åŽŸæ ¼å¼]"]})]}),e.jsx("button",{onClick:k,disabled:f,className:`px-8 py-2 rounded-lg text-white font-medium transition-all ${f?"bg-slate-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-500/30"}`,children:f?"ä¸Šä¼ ä¸­...":"å¼€å§‹ä¸Šä¼ "})]}),N&&e.jsx("p",{className:"mt-2 text-red-500 text-sm",children:N})]}),x&&e.jsxs("div",{className:"bg-green-50/80 p-6 rounded-2xl border border-green-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:"ä¸Šä¼ æˆåŠŸï¼"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-green-700 mb-1",children:"å›¾ç‰‡é“¾æŽ¥"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:x.url,className:"flex-1 px-3 py-2 bg-white border border-green-200 rounded-lg text-sm text-slate-600"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(x.url),className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 text-sm font-medium",children:"å¤åˆ¶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-green-700 mb-1",children:"Markdown"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:x.markdown,className:"flex-1 px-3 py-2 bg-white border border-green-200 rounded-lg text-sm text-slate-600"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(x.markdown),className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 text-sm font-medium",children:"å¤åˆ¶"})]})]})]}),e.jsx("button",{onClick:()=>{o(null),c(null),h(null),m("")},className:"mt-6 w-full py-2 text-green-700 hover:bg-green-100 rounded-lg transition-colors text-sm",children:"ä¸Šä¼ ä¸‹ä¸€å¼ "})]})]})]})}export{P as default};
