import{j as e}from"./markdown-vendor.js";import{r as l}from"./react-vendor.js";const y="cos_config",O=()=>{const a=localStorage.getItem(y);if(a)try{return JSON.parse(a)}catch{return{useDefault:!0}}return{useDefault:!0}},E=a=>{localStorage.setItem(y,JSON.stringify(a))};function T(){const[a,D]=l.useState(O()),[i,x]=l.useState(null),[v,m]=l.useState(null),[j,f]=l.useState(""),[g,w]=l.useState(!1),[n,d]=l.useState(null),[N,o]=l.useState(null),[C,b]=l.useState(!1);l.useEffect(()=>{const t=s=>{if(s.clipboardData&&s.clipboardData.items)for(let r=0;r<s.clipboardData.items.length;r++){const c=s.clipboardData.items[r];if(c.type.indexOf("image")!==-1){const u=c.getAsFile();u&&p(u)}}};return window.addEventListener("paste",t),()=>window.removeEventListener("paste",t)},[]);const p=t=>{x(t),f(t.name),d(null),o(null);const s=new FileReader;s.onloadend=()=>{m(s.result)},s.readAsDataURL(t)},h=l.useCallback(t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?b(!0):t.type==="dragleave"&&b(!1)},[]),k=l.useCallback(t=>{t.preventDefault(),t.stopPropagation(),b(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&p(t.dataTransfer.files[0])},[]),S=async()=>{if(!a.useDefault){o("è¯·å‹¾é€‰ä½¿ç”¨é»˜è®¤é…ç½®ä»¥è¿›è¡Œä¸Šä¼ ");return}if(!i){o("è¯·é€‰æ‹©æ–‡ä»¶");return}w(!0),o(null);try{const t=new FormData,s=new File([i],j,{type:i.type});t.append("file",s);const r=await fetch("/api/v1/upload",{method:"POST",body:t});if(!r.ok){const u=await r.json().catch(()=>({}));throw new Error(u.detail||"ä¸Šä¼ å¤±è´¥")}const c=await r.json();d(c)}catch(t){console.error(t),o(t.message||"ä¸Šä¼ å¤±è´¥")}finally{w(!1)}};return e.jsxs("div",{className:"h-full flex flex-col p-6 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"å›¾åºŠä¸Šä¼ "}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer text-sm text-slate-600 bg-white/50 px-3 py-2 rounded-lg hover:bg-white/80 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:a.useDefault,onChange:t=>{const s={useDefault:t.target.checked};D(s),E(s)},className:"rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆè¯·æŒ‰éœ€ä½¿ç”¨ï¼‰"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6",children:[e.jsx("div",{className:`flex-1 border-2 border-dashed rounded-3xl flex flex-col items-center justify-center p-8 transition-all ${C?"border-blue-500 bg-blue-50/50":"border-slate-300 hover:border-blue-400 bg-white/30"}`,onDragEnter:h,onDragLeave:h,onDragOver:h,onDrop:k,children:v?e.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center",children:[e.jsx("img",{src:v,alt:"Preview",className:"max-h-[60vh] object-contain rounded-lg shadow-lg mb-4"}),e.jsx("button",{onClick:()=>{x(null),m(null),d(null)},className:"absolute top-0 right-0 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 shadow-md transform translate-x-1/2 -translate-y-1/2",children:"âœ•"})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¤"}),e.jsx("p",{className:"text-xl text-slate-600 mb-2",children:"ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ"}),e.jsx("p",{className:"text-sm text-slate-400",children:"æ”¯æŒ Ctrl+V ç²˜è´´"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>t.target.files&&t.target.files[0]&&p(t.target.files[0]),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})}),i&&!n&&e.jsxs("div",{className:"bg-white/60 p-6 rounded-2xl backdrop-blur-sm border border-white/40 shadow-sm",children:[e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"æ–‡ä»¶å"}),e.jsx("input",{type:"text",value:j,onChange:t=>f(t.target.value),className:"w-full px-3 py-2 bg-white/50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("button",{onClick:S,disabled:g,className:`px-8 py-2 rounded-lg text-white font-medium transition-all ${g?"bg-slate-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-500/30"}`,children:g?"ä¸Šä¼ ä¸­...":"å¼€å§‹ä¸Šä¼ "})]}),N&&e.jsx("p",{className:"mt-2 text-red-500 text-sm",children:N})]}),n&&e.jsxs("div",{className:"bg-green-50/80 p-6 rounded-2xl border border-green-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:"ä¸Šä¼ æˆåŠŸï¼"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-green-700 mb-1",children:"å›¾ç‰‡é“¾æŽ¥"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:n.url,className:"flex-1 px-3 py-2 bg-white border border-green-200 rounded-lg text-sm text-slate-600"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(n.url),className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 text-sm font-medium",children:"å¤åˆ¶"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-green-700 mb-1",children:"Markdown"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:n.markdown,className:"flex-1 px-3 py-2 bg-white border border-green-200 rounded-lg text-sm text-slate-600"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(n.markdown),className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 text-sm font-medium",children:"å¤åˆ¶"})]})]})]}),e.jsx("button",{onClick:()=>{x(null),m(null),d(null),f("")},className:"mt-6 w-full py-2 text-green-700 hover:bg-green-100 rounded-lg transition-colors text-sm",children:"ä¸Šä¼ ä¸‹ä¸€å¼ "})]})]})]})}export{T as default};
